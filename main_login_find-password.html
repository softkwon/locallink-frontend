<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비밀번호 찾기 - LocalLink</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <a href="index.html">
                    <img id="headerLogoImg" src="" alt="LocalLink 로고" class="header-logo-img">
                </a>
            </div>
        </div>
    </header>

    <main class="container">
        <section class="form-section login-form-section">
            <h2>비밀번호 찾기</h2>
            <p>가입 시 사용한 이메일 주소를 입력하시면, 비밀번호 재설정 링크를 보내드립니다.</p>

            <form id="findPasswordForm">
                <div class="form-group">
                    <label for="email">가입한 이메일 주소</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="button-primary">재설정 링크 받기</button>
                </div>
                <div class="form-links">
                    <a href="main_login.html">로그인 페이지로 돌아가기</a>
                </div>
            </form>
            <p id="response-message" class="form-message" style="margin-top: 15px;"></p>
        </section>
    </main>
    

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const findPasswordForm = document.getElementById('findPasswordForm');
            const emailInput = document.getElementById('email');
            const responseMessage = document.getElementById('response-message');

            findPasswordForm.addEventListener('submit', async function(event) {
                event.preventDefault();
                
                const email = emailInput.value;
                if (!email) {
                    responseMessage.textContent = '이메일을 입력해주세요.';
                    responseMessage.style.color = 'red';
                    return;
                }

                try {
                    // 우리가 만든 백엔드 API 호출
                    const response = await fetch(`${API_BASE_URL}/auth/request-password-reset`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ email: email })
                    });

                    const result = await response.json();

                    // 성공/실패 여부와 상관없이 동일한 안내 메시지를 보여주는 것이 보안에 더 좋습니다.
                    responseMessage.textContent = result.message;
                    if(response.ok) {
                        responseMessage.style.color = 'green';
                        emailInput.disabled = true; // 성공 시 재요청 방지를 위해 입력창 비활성화
                        document.querySelector('button[type="submit"]').disabled = true;
                    } else {
                        responseMessage.style.color = 'red';
                    }

                } catch (error) {
                    console.error('비밀번호 재설정 요청 실패:', error);
                    responseMessage.textContent = '오류가 발생했습니다. 잠시 후 다시 시도해주세요.';
                    responseMessage.style.color = 'red';
                }
            });
        });
    </script>
    <footer id="footer-placeholder"></footer>
    <script type="module" src="js/auth.js" defer></script>

</body>
</html>